## ElasticSearch

### ElasticSearch的功能，干什么的？

- 分布式的搜索引擎和数据分析引擎

  - 搜索：百度，网站的站内搜索，IT系统的检索
  - 数据分析：电商网站，最近7天的牙膏这种商品排名前10的商家有哪些；新闻网站，最近1个月访问量排名前三的新闻板块是那些
  - 分布式，搜索，数据分析

- 全文检索，结构化检索，数据分析

  - 全文检索：像搜索商品名称包含牙膏的商品

  > select * from products where product_name like '%牙膏%'

  - 结构化检索：想要搜索商品分类为日化用品的商品都有哪些

  > select * from products where category_id = '日化用品'

  - 部分匹配、自动完成、搜索纠错】搜索推荐

  - 数据分析：分析每一个商品分类下有多少个商品

  > select category_id,count(*) from products group by category_id

- 对海量数据进行近实时的处理

  - 分布式：ES自动可以将海量数据分散到多台服务器上去存储和检索
  - 海量数据的处理：分布式以后，就可以采用大量的服务器去存储和检索数据，自然而然就可以实现海量数据的处理
  - 近实时：检索个数据要花费1分钟就不是近实时，秒级别对数据进行搜索和分析才是近实时

- 跟分布式/海量数据想法的：lucene，单机应用，智能在单台服务器上使用，最多智能处理单台服务器可以处理的数据量

### ElasticSearch的使用场景，能在什么地方发挥作用

- 维基百科，全文检索，高亮，搜索推荐
- 用户日志+社交网络数据，分析，新闻文章的公众反馈
- Stack Overflow（国外的程序一场讨论论坛），全文检索，搜索相关问题和答案
- Github，搜索千亿行代码
- 电商网站，检索商品
- 日志数据分析，logstash采集日志，ES进行复杂的数据分析（ELK技术，**elasticsearch+logstash+kibana**）
- 商品价格监控网站，用户设定某商品的价格阙值，当低于该阙值的时候，发送通知消息给用户
- BI系统，ES执行数据分析和挖掘，Kibana进行数据可视化
- 国内：站内搜索（电商，招聘，门户，等等），IT系统搜索（OA，CRM，ERP，等等）

### ElasticSearch的特点，跟其他类似的东西不同的地方在哪里

- 可以作为一个大型分布式集群技术，处理PB级数据，服务大公司；也可以运行在单机上，服务小公司
- ElasticSearch不是什么新技术，主要讲全文检索，数据分析以及分布式技术，合并在了一起，才形成了独一无二的ES
- 对用户而言，是开箱即用的，分厂简单
- 数据库的功能面多很多领域是不够用的，比如全文检索，同义词处理，相关度排名，复杂数据分析，海量数据的近实时处理；ElasticSearch作为传统数据库的一个补充，提供了数据库不能提供的很多功能

### ElasticSearch的核心概念

- Near Realtime(NRT):近实时，两个意思，从吸入数据到数据可以被搜索有一个延迟（1秒）；基于es执行搜索和分析可以达到秒级
- Cluster：集群，包含多个节点，每个节点属于哪个集群是通过一个配置（集群名称，默认是ElasticSearch）来决定的，对于中小型应用来说，刚开始一个集群一个节点就很张昌
- Node：节点，集群中的一个节点，节点也有一个名称（默认是随机分配的），节点名称很重要（在执行运维管理操作的时候），默认节点会去加入一个名称为“ElasticSearch”的集群，如果直接启动一堆节点，那么它们就会自动组成一个ElasticSearch集群，当然一个系欸但也可以组成一个ElasticSearch集群
- Document：文档；es中最小的数据单元，一个document可以是一条数据，一条商品分类数据，一条订单数据，通常用JSOn数据结构表示，每个index下的type中，都可以去存储多个document。

```json
{
    "product_id":"1",
    "product_name":"高露洁牙膏",
    "product_desc":"高校美白",
    "category_id":"2",
    "category_name":"日化用品"
}
```



- Index：索引；包含一堆有相似结构的文档数据，比如可以有一个客户数据，商品分类索引，订单索引，索引有一个名称
- Type：类型，每个索引里都可以有一个或者多个type，type是index中一个逻辑数据分类，一个type下的document，都有相同的field，比如博客系统，有一个索引，可以定义用户数据type，博客数据type，评论数据type
- shard：单台机器无法存储大量数据，es可以将一个索引中的数据分为多个shard，分布在堕胎数据其上存储。有了shard就可以横向扩展，存储更多的数据，让搜索和分析等操作分不到多台服务器上执行，提升吞吐量和性能。每个shard都是一个lucene index。
- replica：任何一个服务器随时可能故障和当即，此时shard可能就会丢失，因此可以为每个shard创建多个replica副本。replica可以在shard鼓掌时提供备用服务，保障数据不丢失，多个replica还可以提升搜索操作的吞吐量和性能，primary shard（建立索引时一次设置，不能修改，默认5个），replica shard（随时修改数量，默认一个），默认每个索引10个shard，5个primary shard ，5个replica shard，最小的高可用配置，是2台服务器

### ElasticSearch核心概念 VS. 数据库核心概念

| ElasticSearch | 数据库 |
| ------------- | ------ |
| Document      | 行     |
| Type | 表 |
| Index | 数据库 |



